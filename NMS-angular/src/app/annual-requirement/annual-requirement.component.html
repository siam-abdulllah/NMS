<div class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-success">
                <div class="box-header with-border">
                    <h3 class="box-title"><strong>Annual Requirement Submission</strong></h3>
                    <button *ngIf="userRole!='SA'" type="button" class="btn btn-sm btn-embossed btn-success btn-add-product" style="float: right; margin-left: 7px;" (click)="searchAnnualRequirements()"><i class="fa fa-search"></i> Search</button>
                    <button *ngIf="userRole=='SA'" type="button" class="btn btn-sm btn-embossed btn-success btn-add-product" style="float: right; margin-left: 7px;" (click)="show()"><i class="fa fa-search"></i> Search</button>

                    <button type="button" class="btn btn-sm btn-primary btn-embossed btn-add-product" style="float: right;  margin-right: 5px;" (click)="viewAnnualReqReport()" [disabled]="mstNo === null || mstNo === undefined"><i class="fa fa-file-pdf"
                  style="color: white;"></i>View Summary Report</button>
                    <button type="button" class="btn btn-sm btn-info btn-embossed btn-add-product" style="float: right;" (click)="confirmAnnualRequirementSubmission()" [disabled]="submitButtonDisable"><i
                  class="fa fa-save"></i> Submit</button>

                    <button type="button" class="btn btn-sm btn-embossed btn-primary btn-add-product" style="float: right;" (click)="confirmAnnualReqSubmission()" [disabled]="annReqUpdateMode || updateBtnDisable">
                <i class="fa fa-save"></i>
                 {{saveButtonTitle}}</button>
                    <button type="button" class="btn btn-sm btn-embossed btn-danger btn-add-product" style="float: right;" (click)="resetPage()"><i class="fa fa-refresh" style="color: white;"></i>Reset</button>
                </div>
                <div class="box-body">
                    <fieldset class="scheduler-border">
                        <legend class="scheduler-border">Annual requirement</legend>
                        <div class="row">
                            <div class="col-md-12">
                                <form [formGroup]="annualRequirementMstForm">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-4">
                                            <div class="form-group m-form__group">
                                                <label for="annual-req-no" class="control-label required">Annual Requirement No</label>
                                                <input type="text" class="form-control" id="annual-req-no" placeholder="auto generated" formControlName="annualReqNo" readonly>
                                            </div>
                                        </div>
                                        <div class="col-md-1"></div>
                                        <div class="col-md-4">
                                            <div class="form-group m-form__group" *ngIf="mstNo">
                                                <label for="submission-date" class="control-label required">Submission Date</label>
                                                <input type="text" class="form-control" id="submission-date" placeholder="auto generated" formControlName="submissionDate" readonly>
                                            </div>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="box" style="border-top: white;">
                <div class="box-body">
                    <div class="row" style="margin-bottom:5px ;">
                        <div class="col-md-2">
                            <!-- <button type="button" class="btn btn-sm btn-embossed btn-success btn-add-product" (click)="openRequireModal('add')" [disabled]="annReqUpdateMode"> -->
                            <button type="button" class="btn btn-sm btn-embossed btn-success btn-add-product" (click)="openRequireModal('add')">
                            <i class="fa fa-plus"></i> Add Product</button>
                        </div>
                        <div class="col-md-8">
                            <input name="filterText" class="form-control m-input" type="text" [(ngModel)]="searchText" placeholder="Search..">
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn btn-sm btn-embossed btn-danger" (click)="resetFilter()"><i class="fa fa-refresh"></i>&nbsp; Reset</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-responsive" style="border: 1px solid #bed2c9; width: 100%;">
                                <table class="table table-bordered table-hover table-striped">
                                    <thead style="background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #289e68), color-stop(1, #f9fafc));">
                                        <tr>
                                            <th scope="col" style="width: 10%">Action</th>
                                            <th scope="col" style="width: 14%">Product<br>Name</th>
                                            <th scope="col" style="width: 6%">Type</th>
                                            <th scope="col" style="width: 7%">H.S.Code</th>
                                            <th scope="col" style="width: 6%">Pack<br>Size</th>
                                            <th scope="col" style="width: 7%">Total<br>Units(Kg/Ltr/Unit)</th>
                                            <th scope="col" style="width: 7%">Total Amount(Ton)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let a of annualRequirements | paginate: { itemsPerPage:10, currentPage: p} | filter: searchText">
                                            <td>
                                                <div class="btn-group dropdown" dropdown container="body">
                                                    <button class="dropdown-toggle btn btn-sm btn-success" dropdownToggle>
                                        <i class="fa fa-cog"></i><span class="caret"></span> Actions
                                    </button>
                                                    <ul class="dropdown-menu" *dropdownMenu>
                                                        <li>
                                                            <a href="javascript:;" (click)="editProduct(a)">Edit</a>
                                                        </li>
                                                        <li>
                                                            <a href="javascript:;" (click)="removeProduct(a)">Delete</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </td>
                                            <td>{{a.prodName}}</td>
                                            <td>{{a.prodType}}</td>
                                            <td>{{a.hsCode}}</td>
                                            <td>{{a.packSize}}</td>
                                            <td style="text-align: right;">{{a.tentativeUnits}}</td>
                                            <td style="text-align: right;">{{a.totalAmount}} MT</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <pagination-controls (pageChange)="p = $event"></pagination-controls>
                        </div>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
    </div>
</div>

<ng-template #taskmodal>
    <div class="modal-header" style="background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #289e68), color-stop(1, #f9fafc));color: black;">
        <h4 class="modal-title pull-left">{{modalTitle}}</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body" style="padding: 20px 50px 20px 50px;">
        <div class="row">
            <div class="col-md-12">
                <fieldset class="scheduler-border">
                    <legend class="scheduler-border">Product Information</legend>
                    <div class="row">
                        <div class="col-md-12">
                            <form [formGroup]="annualRequirementsForm" (submit)="addUpdateProduct()">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group m-form__group">
                                            <label for="product-name" class="control-label required">Product Name</label>
                                            <span style="color:red;">*</span>
                                            <input type="text" class="form-control" id="product-name" [ngClass]="{'is-invalid': annualRequirementsForm.get('prodName').errors && annualRequirementsForm.get('prodName').touched}" formControlName="prodName">
                                            <div class="invalid-feedback" *ngIf="annualRequirementsForm.get('prodName').hasError('required')
                                           && annualRequirementsForm.get('prodName').touched">Product name required</div>
                                            <div class="invalid-feedback" *ngIf="annualRequirementsForm.get('prodName').hasError('maxlength')
                                              && annualRequirementsForm.get('prodName').touched"> Product name can be max 50 Character long</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-name" class="control-label required">Product Type</label>
                                            <span style="color:red;">*</span>
                                            <ng-select [items]="productTypes" bindLabel="name" bindValue="name" placeholder="Select Product Type" [ngClass]="{'is-invalid': annualRequirementsForm.get('prodType').errors && annualRequirementsForm.get('prodType').touched}" formControlName="prodType">
                                            </ng-select>
                                            <div class="invalid-feedback" *ngIf="annualRequirementsForm.get('prodType').hasError('required')
                                       && annualRequirementsForm.get('prodType').touched"> Product type is required</div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-name" class="control-label required">H.S. Code</label>
                                            <span style="color:red;">*</span>
                                            <input type="text" class="form-control" id="product-name" [ngClass]="{'is-invalid': annualRequirementsForm.get('hsCode').errors && annualRequirementsForm.get('hsCode').touched}" formControlName="hsCode">
                                            <div class="invalid-feedback" *ngIf="annualRequirementsForm.get('prodName').hasError('required')
                                          && annualRequirementsForm.get('hsCode').touched">H.S. code required</div>
                                            <div class="invalid-feedback" *ngIf="annualRequirementsForm.get('hsCode').hasError('maxlength')
                                             && annualRequirementsForm.get('hsCode').touched">H.S. code can be max 50 Character long</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-name" class="control-label required">Pack Size</label>
                                            <span style="color:red;">*</span>
                                            <input type="text" class="form-control" id="manufacturer" [ngClass]="{'is-invalid': annualRequirementsForm.get('packSize').errors && annualRequirementsForm.get('packSize').touched}" formControlName="packSize">
                                            <div class="invalid-feedback" *ngIf="annualRequirementsForm.get('packSize').hasError('required')
                                        && annualRequirementsForm.get('packSize').touched">Pack size required</div>
                                            <div class="invalid-feedback" *ngIf="annualRequirementsForm.get('packSize').hasError('maxlength')
                                          && annualRequirementsForm.get('packSize').touched">Pack size can be max 100 Character long</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="total-quantity" class="control-label required">Total Amount(Tons)</label>
                                            <small style="color:#888889;"> numeric value</small>
                                            <input type="number" min="0" class="form-control" id="total-quantity" name="totalAmount" autocomplete="off" formControlName="totalAmount" (input)="isDisableUnit()">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-name" class="control-label required">Total Units(Kg/Ltr/Unit)</label>
                                            <small style="color: #888889;"> numeric value</small>
                                            <input type="number" min="0" class="form-control" id="tentativeUnits" name="tentativeUnits" autocomplete="off" formControlName="tentativeUnits" (input)="isDisableTon()">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                    </div>
                                    <div class="col-md-4">
                                        <button type="submit" *ngIf="addMode" class="btn btn-success btn-md" style="width: 100px;" [disabled]="!annualRequirementsForm.valid">Add</button>
                                        <button type="submit" *ngIf="editMode" class="btn btn-success btn-md" style="width: 100px;" [disabled]="!annualRequirementsForm.valid">Update</button>
                                        <button type="button" class="btn btn-danger btn-md" (click)="modalRef.hide()" style="margin-right:20px;width: 100px; ">Cancel</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #annualReqsModal>
    <div class="modal-header" style="background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #289e68), color-stop(1, #f9fafc));color: black;">
        <h4 class="modal-title pull-left">Annual Requirements</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body" style="padding: 20px 30px 20px 30px;">
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <input name="filterText" class="form-control m-input" type="text" [(ngModel)]="searchText" placeholder="Search..">
            </div>
            <div class="col-md-1"></div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive" style="border: 1px solid #bed2c9; width: 100%;">
                    <table class="table table-bordered table-responsive table-hover table-striped">
                        <thead style="background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #289e68), color-stop(1, #f9fafc));">
                            <tr>
                                <th scope="col" style="width: 7%">Action</th>
                                <th scope="col" style="width: 5%;display: none;">Id</th>
                                <th scope="col" style="width: 8%">Annual<br>Req<br>No</th>
                                <th scope="col" style="width: 7%;">Importer</th>
                                <th scope="col" style="width: 10%">Submission<br>Date</th>
                                <th scope="col" style="width: 30%;overflow: hidden;">Products</th>
                                <th scope="col" style="width: 30%;overflow: hidden;">Pack Size</th>
                                <th scope="col" style="width: 8%;">Total<br>Amounts</th>
                                <th scope="col" style="width: 8%;">Total<br>Units(Kg/Ltr/Unit)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let a of annReqs |paginate: { itemsPerPage:8, currentPage: p} | filter: searchText">
                                <!-- <td><button class="btn btn-sm btn-success btn-grid-action" (click)="selectAnnualReq(a)"><i class="fas fa-check icon-action"></i></button> </td> -->
                                <td><button class="btn btn-sm btn-success" (click)="selectAnnualReq(a)">Details</button> </td>
                                <td style="display: none;">{{a.id}}</td>
                                <td>{{a.annualReqNo}}</td>
                                <!-- <td style="display: none;">{{a.importerId}}</td> -->
                                <td>{{a.importerId}}</td>
                                <td>
                                    <div *ngIf="a.submissionDate == null" style="background-color: #ffb822;">
                                        Not Submitted
                                    </div>
                                    <div *ngIf="a.submissionDate">
                                        {{a.submissionDate | date}}
                                    </div>
                                </td>
                                <!-- <td>{{a.submissionDate| date}}</td> -->
                                <td>
                                    <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                        <li>{{d.prodName}}</li>
                                    </ul>
                                </td>
                                <td>
                                    <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                        <li>{{d.packSize}}</li>
                                    </ul>
                                </td>
                                <td style="text-align: right;">
                                    <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                        <li>{{d.totalAmount}} MT</li>
                                    </ul>
                                </td>
                                <td style="text-align: right;">
                                    <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                        <li>{{d.tentativeUnits}}</li>
                                    </ul>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <pagination-controls (pageChange)="p = $event"></pagination-controls>
            </div>
        </div>
    </div>
</ng-template>
<div class="content">
    <div bsModal #annualReqsModalNew="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="annualReqsModalNew" aria-hidden="true" [config]="{backdrop: 'static'}">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #289e68), color-stop(1, #f9fafc));color: black;">
                    <h4 class="modal-title">
                        <span>Annual Requirements</span>
                    </h4>
                    <button type="button" class="close" (click)="close()" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
                </div>
                <div class="content">
                    <div class="m-portlet m-portlet--mobile">
                        <div class="m-portlet__body">
                            <form class="horizontal-form" autocomplete="off">
                                <div class="m-form m-form--label-align-right">
                                    <div class="row align-items-center m--margin-bottom-10">
                                        <div class="col-md-12">
                                            <div class="form-group m-form__group align-items-center">
                                                <div class="input-group">
                                                    <input [(ngModel)]="filterText" name="filterText" autoFocus class="form-control m-input" type="text">
                                                    <span class="input-group-btn">
                              <button (click)="getAll()" class="btn btn-primary" type="submit"><i
                                  class="flaticon-search-1"></i></button>
                            </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <div class="row">
                                <!--<Primeng-Datatable-Start>-->
                                <div class="col-md-12">
                                    <div class="primeng-datatable-container" style="border: 1px solid #bed2c9; width: 100%;">
                                        <p-table #dataTable (onLazyLoad)="getAll($event)" [value]="primengTableHelper.records" rows="5" [paginator]="false" [lazy]="true" [scrollable]="true" ScrollWidth="100%" [responsive]="primengTableHelper.isResponsive" [resizableColumns]="primengTableHelper.resizableColumns"
                                            class="table table-bordered table-responsive table-hover table-striped">
                                            <ng-template pTemplate="header">
                                                <tr style=" font-size: 12px;">
                                                    <th>Actions</th>
                                                    <th style="display: none;">Id</th>
                                                    <th>Annual<br>Req<br>No</th>
                                                    <th>Importer</th>
                                                    <th>Submission<br>Date</th>
                                                    <th style="overflow: hidden;">Products</th>
                                                    <th style="overflow: hidden;">Pack Size</th>
                                                    <!-- <th  style="width: 20%;overflow: hidden;">Countries</th>
                                                    <th  style="width: 0%;display: none;;">Manufactures</th> -->
                                                    <!-- <th  style="width: 5%; display: none;">Currencies</th> -->
                                                    <th>Total<br>Amounts</th>
                                                    <th>Total<br>Units <br> (Kg/Ltr/Unit)</th>
                                                    <!-- <th  style="width: 12%;display: none;">Total<br>Prices</th>
                                                    <th  style="width: 10%;">Total<br>Price(BDT)</th> -->
                                                </tr>
                                            </ng-template>
                                            <ng-template pTemplate="body" let-a="$implicit">
                                                <tr style=" font-size: 12px;">
                                                    <td><button class="btn btn-sm btn-success" (click)="selectAnnualReq(a)">Details</button> </td>
                                                    <td style="display: none;">{{a.id}}</td>
                                                    <td>{{a.annualReqNo}}</td>
                                                    <!-- <td style="display: none;">{{a.importerId}}</td> -->
                                                    <td>{{a.importerId}}</td>
                                                    <td>{{a.submissionDate| date}}</td>
                                                    <td>
                                                        <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                                            <li>{{d.prodName}}</li>
                                                        </ul>
                                                    </td>
                                                    <td>
                                                        <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                                            <li>{{d.packSize}}</li>
                                                        </ul>
                                                    </td>
                                                    <td style="text-align: right;">
                                                        <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                                            <li>{{d.totalAmount}} MT</li>
                                                        </ul>
                                                    </td>
                                                    <td style="text-align: right;">
                                                        <ul type="none" *ngFor="let d of a.annualRequirementDtls">
                                                            <li>{{d.tentativeUnits}}</li>
                                                        </ul>
                                                    </td>
                                                </tr>
                                            </ng-template>
                                        </p-table>
                                        <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                                            NoData
                                        </div>
                                        <div class="primeng-paging-container">
                                            <p-paginator rows="{{primengTableHelper.defaultRecordsCountPerPage}}" #paginator styleClass="role-lookup-table-paginator" (onPageChange)="getAll($event)" [totalRecords]="primengTableHelper.totalRecordsCount" [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage">
                                            </p-paginator>
                                            <span class="total-records-count">
                          <b>Total: </b> {{primengTableHelper.totalRecordsCount}}
                        </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary blue" (click)="close()">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- <app-annual-requirement></app-annual-requirement> -->
</div>
<ng-template #confirmModal>
    <div class="modal-body text-center">
        <div>
            <h4>আপনি কি অ্যানুয়াল রিকোয়ারমেন্টটি {{saveUpdateMsg}} করতে চান ?</h4>
            <p>( বিঃ দ্রঃ অ্যানুয়াল রিকোয়ারমেন্টটি {{saveUpdateMsg}} করে পরবর্তী প্রসেসের জন্য অবশ্যই সাবমিট করতে হবে )</p>
        </div>
        <button type="button" class="btn btn-success" (click)="confirm()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="decline()">No</button>
    </div>
</ng-template>
<ng-template #annualReqSubmissionConfirmModal>
    <div class="modal-body text-center">
        <div>
            <h4>আপনি কি অ্যানুয়াল রিকোয়ারমেন্টটি সাবমিট করতে চান ?</h4><small>( বিঃ দ্রঃ সাবমিটেড অ্যানুয়াল রিকোয়ারমেন্ট অপরিবর্তনযোগ্য )</small>
        </div>
        <button type="button" class="btn btn-success" (click)="confirmSubmit()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="declineSubmit()">No</button>
    </div>
</ng-template>
<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '0',fullScreenBackdrop:true }"></ngx-loading>